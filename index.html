<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crafting-Rechner</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    select, input, button { margin: 5px 0; padding: 6px; font-size: 16px; }
    label { font-weight: bold; }
    #ausgabe { background: white; padding: 10px; border-radius: 5px; }
    pre { white-space: pre-wrap; }
    .btn-row { text-align: right; margin-top: 10px; }
  </style>
</head>
<body>

  <h1>🛠️ Crafting-Rechner</h1>

  <label>Anzahl herstellen: 
    <input type="number" id="anzahl" value="1" min="1" onchange="zeigeErgebnis(document.getElementById('itemSelect').value)">
  </label>

  <br/>

  <label>Item wählen: 
    <select id="itemSelect" onchange="zeigeErgebnis(this.value)">
      <option disabled selected>Bitte Item wählen</option>
    </select>
  </label>

  <pre id="ausgabe"></pre>

  <div class="btn-row">
    <button onclick="exportCSV()">📤 Export CSV</button>
    <input type="file" accept=".csv" onchange="importCSV(event)">
  </div>


  <script>
    const rezepte = {
      "craft_1": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_1", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 25]
        ]
      },
      
      "craft_2": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_1", 1],
          ["schem_2", 1],
          ["craft_karrosserie", 3],
          ["craft_motor", 4],
          ["craft_reifen", 2],
          ["craft_getriebe", 8],
          ["craft_batterie", 2],
          ["craft_elektrik", 2],
          ["stoff", 25],
          ["schwer_stoff", 10]
        ]
      },
      
      "craft_3": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_3", 1],
          ["craft_karrosserie", 4],
          ["craft_reifen", 4],
          ["craft_getriebe", 2],
          ["craft_batterie", 5],
          ["craft_elektrik", 2],
          ["craft_elektronik", 3],
          ["stoff", 50],
          ["schwer_stoff", 25]
        ]
      },
      
      "craft_4": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_4", 1],
          ["craft_karrosserie", 6],
          ["craft_reifen", 4],
          ["craft_getriebe", 2],
          ["craft_batterie", 10],
          ["craft_elektrik", 4],
          ["craft_elektronik", 3],
          ["stoff", 50],
          ["schwer_stoff", 55]
        ]
      },
      
      "craft_5": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_4", 1],
          ["schem_5", 1],
          ["craft_karrosserie", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 4],
          ["craft_batterie", 8],
          ["craft_elektrik", 6],
          ["craft_elektronik", 6],
          ["stoff", 75],
          ["schwer_stoff", 25]
        ]
      },
      
      "craft_6": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_6", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 3],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 4],
          ["stoff", 75],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_7": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_7", 1],
          ["craft_karrosserie", 8],
          ["craft_motor", 6],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 2],
          ["craft_elektrik", 10],
           ["craft_elektronik", 8],
          ["stoff", 75],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_8": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_7", 1],
          ["schem_8", 1],
          ["craft_karrosserie", 15],
          ["craft_motor", 4],
          ["craft_reifen", 2],
          ["craft_getriebe", 8],
          ["craft_batterie", 4],
          ["craft_elektrik", 15],
          ["craft_elektronik", 10],
          ["stoff", 150],
          ["schwer_stoff", 25]
        ]
      },
      
      "craft_9": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_9", 1],
          ["craft_karrosserie", 3],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 4],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 20]
        ]
      },
      
      "craft_10": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_9", 1],
          ["schem_10", 1],
          ["craft_karrosserie", 3],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 2],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 20]
        ]
      },
      
      "craft_11": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_11", 1],
          ["craft_karrosserie", 2],
          ["craft_motor", 1],
          ["craft_reifen", 4],
          ["craft_getriebe", 2],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 40],
          ["schwer_stoff", 10]
        ]
      },
      
      "craft_12": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_11", 1],
          ["schem_12", 1],
          ["craft_karrosserie", 2],
          ["craft_motor", 3],
          ["craft_reifen", 4],
          ["craft_getriebe", 4],
          ["craft_batterie", 2],
          ["craft_elektrik", 3],
          ["stoff", 40],
          ["schwer_stoff", 10]
        ]
      },
      "craft_13": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_13", 1],
          ["craft_karrosserie", 1],
          ["craft_motor", 1],
          ["craft_reifen", 1],
          ["craft_getriebe", 1],
          ["craft_batterie", 1],
          ["craft_elektrik", 1],
          ["stoff", 10],
          ["schwer_stoff", 5]
        ]
      },
      
      "craft_14": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_14", 1],
          ["craft_karrosserie", 10],
          ["craft_motor", 5],
          ["craft_reifen", 4],
          ["craft_getriebe", 5],
          ["craft_batterie", 1],
          ["craft_elektrik", 8],
          ["craft_elektronik", 6],
          ["stoff", 80],
          ["schwer_stoff", 40]
        ]
      },
      
      "craft_15": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_15", 1],
          ["craft_karrosserie", 3],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 5],
          ["craft_batterie", 1],
          ["craft_elektrik", 3],
          ["stoff", 75],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_16": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_15", 1],
          ["schem_16", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 4],
          ["stoff", 80],
          ["schwer_stoff", 20]
        ]
      },
      
      "craft_17": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_17", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 4],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 40],
          ["schwer_stoff", 20]
        ]
      },
      
      "craft_18": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_18", 1],
          ["craft_karrosserie", 6],
          ["craft_motor", 4],
          ["craft_reifen", 4],
          ["craft_getriebe", 8],
          ["craft_batterie", 1],
          ["craft_elektrik", 4],
          ["stoff", 150],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_19": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_18", 1],
          ["schem_19", 1],
          ["craft_karrosserie", 8],
          ["craft_motor", 6],
          ["craft_reifen", 4],
          ["craft_getriebe", 10],
          ["craft_batterie", 2],
          ["craft_elektrik", 8],
          ["craft_elektronik", 2],
          ["stoff", 150],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_20": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_24", 1],
          ["schem_20", 1],
          ["craft_karrosserie", 20],
          ["craft_motor", 10],
          ["craft_reifen", 6],
          ["craft_getriebe", 20],
          ["craft_batterie", 4],
          ["craft_elektrik", 20],
          ["craft_elektronik", 12],
          ["stoff", 250],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_21": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_20", 1],
          ["schem_21", 1],
          ["craft_karrosserie", 25],
          ["craft_motor", 12],
          ["craft_reifen", 6],
          ["craft_getriebe", 25],
          ["craft_batterie", 6],
          ["craft_elektrik", 25],
          ["craft_elektronik", 14],
          ["stoff", 300],
          ["schwer_stoff", 150]
        ]
      },
      
      "craft_22": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_21", 1],
          ["schem_22", 1],
          ["craft_karrosserie", 30],
          ["craft_motor", 15],
          ["craft_reifen", 6],
          ["craft_getriebe", 30],
          ["craft_batterie", 8],
          ["craft_elektrik", 35],
          ["craft_elektronik", 18],
          ["stoff", 400],
          ["schwer_stoff", 200]
        ]
      },
      
      "craft_23": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_25", 1],
          ["schem_23", 1],
          ["craft_karrosserie", 50],
          ["craft_motor", 40],
          ["craft_reifen", 6],
          ["craft_getriebe", 55],
          ["craft_batterie", 16],
          ["craft_elektrik", 40],
          ["craft_elektronik", 25],
          ["stoff", 800],
          ["schwer_stoff", 600]
        ]
      },
      
      "craft_24": {
        wert: 6600000,
        dauer: 120,
        itemsRequired: [
          ["craft_scaniat1", 1],
        ]
      },
      
      "craft_25": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["craft_mant1", 1],
        ]
      },
      
      "craft_karrosserie": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["aluPlatte", 50],
          ["stahlPlatte", 10],
          ["eisenStange", 25],
          ["kupferFolie", 15],
          ["kupferDraht", 5],
        ]
      },
      
      "craft_motor": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["motoroil", 10],
          ["aluBox", 3],
          ["plastic", 35],
          ["stahlBarren", 40],
          ["kupferFolie", 20],
        ]
      },
      
      "craft_reifen": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["gummi", 40],
          ["stahlBarren", 2],
          ["aluBarren", 40],
          ["plastic", 5],
        ]
      },
      
      "craft_carbon": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["aluPlatte", 20],
          ["plastic", 10],
          ["kohleStein", 5],
          ["kohleBraun", 40],
        ]
      },
      
      "craft_elektrik": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["eisenStange", 10],
          ["kupferFolie", 25],
          ["kupferDraht", 40],
          ["plastic", 35],
          ["gummi", 15],
          ["aluPlatte", 2],
        ]
      },
      
      "craft_batterie": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["aluBox", 10],
          ["schwefelacid", 25],
          ["plastic", 40],
          ["gummi", 5],
          ["craft_elektrik", 5],
        ]
      },
      
      "craft_getriebe": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["stahlBarren", 10],
          ["stahlPlatte", 25],
          ["eisenStange", 40],
          ["getriebeoil", 20],
        ]
      },
      
      "craft_elektronik": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["eisenStange", 15],
          ["kupferFolie", 40],
          ["kupferDraht", 60],
          ["plastic", 50],
          ["gummi", 20],
          ["aluPlatte", 4],
          ["craft_elektrik", 3],
          ["rubin", 5]
        ]
      },
      
      "schwer_stoff": {
        wert: 0,
        dauer: 4.8,
        itemsRequired: [
          ["stoff", 1],
          ["aluBarren", 0.4],
        ]
      },
      
      "stoff": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["cotton", 2],
        ]
      },
      
      "kupferFolie": {
        wert: 0,
        dauer: 4.8,
        itemsRequired: [
          ["kupferBarren", 0.5],
        ]
      },
      "kupferDraht": {
        wert: 0,
        dauer: 4.8,
        itemsRequired: [
          ["kupferBarren", 1],
        ]
      },
      
      "kupferPulver": {
        wert: 0,
        dauer: 4.8,
        itemsRequired: [
          ["kupferBarren", 2],
        ]
      },
      "eisenPlatte": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["eisenBarren", 1],
        ]
      },
      "eisenStange": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["eisenBarren", 1],
        ]
      },
      
      "aluPlatte": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["aluBarren", 1],
        ]
      },
      
      "stahlPlatte": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["stahlBarren", 1],
        ]
      },
      
      "aluBox": {
        wert: 0,
        dauer: 1,2,
        itemsRequired: [
          ["aluBarren", 3],
        ]
      },
      
      "aluBarren": {
        wert: 371,
        dauer: 0.35,
        itemsRequired: [
          ["aluErz", 1],
          ["schwefelacid", 0.3],
          ["schlacke", 0.3],
        ]
      },
      
      "eisenBarren": {
        wert: 81,
        dauer: 0.83,
        itemsRequired: [
          ["eisenErz", 1],
        ]
      },
      
      "kupferBarren": {
        wert: 96,
        dauer: 0.83,
        itemsRequired: [
          ["kupferErz", 1],
        ]
      },
      "stahlBarren": {
        wert: 0,
        dauer: 0,
        itemsRequired: [
          ["kohleBraun", 3],
          ["eisenBarren", 3],
        ]
      },
      "aluBox": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["aluBarren", 3],
        ]
      },
      "aluBox": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["aluBarren", 3],
        ]
      },
           
      "Test": {
        wert: 1000000000,
        dauer: 0,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_1", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 25]
        ]
      },

      
    };

    const anzeigeNamen = {
      "craft_1": "Corvette C2",
      "craft_2": "Corvette C2 Stingray",
      "craft_3": "Tesla X",
      "craft_4": "Cybertruck_v1",
      "craft_5": "Cybertruck_v2",
      "craft_6": "Javelin",
      "craft_7": "Regalia_v1",
      "craft_8": "Regalia_v2",
      "craft_9": "zType_GTAV_v1",
      "craft_10": "zType_GTAV_v2",
      "craft_11": "Hotknife_GTAV_v1",
      "craft_12": "Hotknife_GTAV_v2",
      "craft_13": "Monobike",
      "craft_14": "Velociraptor",
      "craft_15": "Coronet",
      "craft_16": "Hornet",
      "craft_17": "Eldorado",
      "craft_18": "vipersrt10acr_v1",
      "craft_19": "vipersrt10acr_v2",
      "craft_20": "Scania_v2",
      "craft_21": "Scania_v3",
      "craft_22": "Scania_v4",
      "craft_23": "Man_Brickade_v2",
      "craft_24": "Kaufbarer Scania_v1 (6,6 Mio)",
      "craft_25": "Kaufbarer Man_Brickade_v1 (18,8",
      "schem_1": "Schablone1",
      "schem_2": "Schablone2",
      "schem_3": "Schablone3",
      "schem_4": "Schablone4",
      "schem_5": "Schablone5",
      "schem_6": "Schablone6",
      "schem_7": "Schablone7",
      "schem_8": "Schablone8",
      "schem_9": "Schablone9",
      "schem_10": "Schablone10",
      "schem_11": "Schablone11",
      "schem_12": "Schablone12",
      "schem_13": "Schablone13",
      "schem_14": "Schablone14",
      "schem_15": "Schablone15",
      "schem_16": "Schablone16",
      "schem_17": "Schablone17",
      "schem_18": "Schablone18",
      "schem_19": "Schablone19",     
      
      "craft_blanko": "Leerer Bauplan",
      "schem_1": "Bauplan Auto",
      "craft_karrosserie": "Karosserie",
      "craft_motor": "Motor",
      "craft_reifen": "Reifen",
      "craft_getriebe": "Getriebe",
      "craft_batterie": "Batterie",
      "craft_elektrik": "Elektrik",
      "craft_elektronik": "Elektronik",
      "stoff": " Einfacher Stoff",
      "schwer_stoff": "Schwerer Stoff",

      "aluPlatte": "Aluplatte",
      "stahlPlatte": "Stahlplatte",
      "stahlBarren": "Stahlbarren",
      "eisenStange": "Eisenstange",
      "eisenBarren": "Eisenbarren",
      "kupferFolie": "Kupferfolie",
      "kupferBarren": "Kupferbarren",
      "kupferDraht": "Kupferdraht",
      "motoroil": "Motoröl",
      "aluBox": "Aluminiumbox",
      "aluBarren": "Aluminiumbarren",
      "plastic": "Kunststoff",
      "gummi": "Gummi",
      "getriebeoil": "Getriebeöl",
      "schwefelacid": "Schwefelsäure",
      "cotton": "Baumwolle",
      "schlacke": "Schlacke",
      "aluErz": "BauxitErz",
      "eisenErz": "Eisenerz",
      "kupferErz": "Kupfererz",
      "kohleBraun": "Braunkohle",
      "kohleStein": "Steinkohle",
      "": "",
      
      
    };

    const fundorte = {
      "kohleBraun": "Kohlemine",
      "kohleStein": "Kohlemine",
      "kupferErz": "Kupfermine",
      "eisenErz": "Eisenmine",
      "aluErz": "Bauxitmine",
      "schwefelacid": "Chemiewerk",
      "aluErz": "Bauxitmine",
      "plastic": "Chemiewerk",
      "gummi": "Chemiewerk",
      "getriebeoil": "Baumarkt",
      "motoroil": "Baumarkt",
    
    
    };

    const rohstoffPreise = {
      "schwefelacid": 85,
      "gummi": 220,
      "plastic": 175,
      "getriebeoil": 135,
      "motoroil": 65,
      "craft_blanko": 1000,
      "kohleBraun": 37,
      "kohleStein": 29,
    };

    const select = document.getElementById("itemSelect");
    const ausgabe = document.getElementById("ausgabe");

    for (let key in rezepte) {
      const opt = document.createElement("option");
      opt.value = key;
      opt.textContent = anzeigeNamen[key] || key;
      select.appendChild(opt);
    }

    function zeigeRezept() {
      const key = select.value;
      if (!key) return ausgabe.textContent = "";

      const materialien = {};
      let gesamtDauer = 0;

      const herstellung = verarbeiteRezept(key, 0, materialien, (dauer) => gesamtDauer += dauer);
      const { liste, kosten } = generiereMaterialListe(materialien);
      const gesamtWert = rezepte[key]?.wert || 0;
      const gewinn = gesamtWert - kosten;

      ausgabe.textContent = herstellung +
        "\n📦 Gesamtliste Rohstoffe:\n" + liste +
        `\n💰 Materialkosten: ${kosten} Coins` +
        `\n💰 Gesamtwert: ${gesamtWert} Coins` +
        `\n📈 Gewinn: ${gewinn} Coins` +
        `\n⏱️ Herstellungsdauer (gesamt): ${gesamtDauer} Minuten`;
    }


  function berechneMaterialienUndProzesse(item, menge = 1, rohstoffe = {}, zwischenprodukte = {}) {
    const daten = rezepte[item];
    if (!daten || !daten.itemsRequired) return;

    if (!zwischenprodukte[item]) {
      zwischenprodukte[item] = { menge: 0, bestandteile: daten.itemsRequired };
    }
    zwischenprodukte[item].menge += menge;

    for (const [subItem, subMenge] of daten.itemsRequired) {
      const gesamtMenge = subMenge * menge;
      if (rezepte[subItem]) {
        berechneMaterialienUndProzesse(subItem, gesamtMenge, rohstoffe, zwischenprodukte);
      } else {
        if (!rohstoffe[subItem]) {
          rohstoffe[subItem] = { menge: 0, verwendetIn: {} };
        }
        rohstoffe[subItem].menge += gesamtMenge;
        rohstoffe[subItem].verwendetIn[item] = (rohstoffe[subItem].verwendetIn[item] || 0) + gesamtMenge;
      }
    }
  }

  function zeigeErgebnis(itemKey) {
    const menge = parseInt(document.getElementById("anzahl").value || "1");
    const rohstoffe = {}, zwischenprodukte = {};
    let gesamtDauer = 0;

    berechneMaterialienUndProzesse(itemKey, menge, rohstoffe, zwischenprodukte);

    function berechneDauer(item, menge) {
      const data = rezepte[item];
      if (data?.dauer) gesamtDauer += data.dauer * menge;
      for (const [sub, m] of data?.itemsRequired || []) {
        if (rezepte[sub]) berechneDauer(sub, m * menge);
      }
    }
    berechneDauer(itemKey, menge);

    let out = `📦 Gesamtliste Rohstoffe:\n`;
    let kosten = 0;
    for (const key in rohstoffe) {
      const r = rohstoffe[key];
      const name = anzeigeNamen[key] || key;
      const ort = fundorte[key] ? ` (Fundort: ${fundorte[key]})` : "";
      const preis = rohstoffPreise[key] || 0;
      const gesamt = preis * r.menge;
      kosten += gesamt;
      out += `- ${r.menge}x ${name}${ort} = ${gesamt} Coins\n`;
      for (const verb in r.verwendetIn) {
        out += `    ↳ benutzt in: ${anzeigeNamen[verb] || verb} (${r.verwendetIn[verb]})\n`;
      }
    }

    out += `\n🔧 Herstellprozesse (abzuhaken):\n`;
    const checkbox = (id) => `<input type="checkbox" id="${id}">`;

    const zpSorted = Object.entries(zwischenprodukte)
      .filter(([k]) => k !== itemKey)
      .sort((a, b) => b[1].menge - a[1].menge);

    zpSorted.forEach(([prod, info]) => {
      const pname = anzeigeNamen[prod] || prod;
      out += `- ${checkbox("check_" + prod)} ${info.menge}x ${pname}\n`;
      info.bestandteile.forEach(([roh, m]) => {
        out += `    ⤷ ${m * info.menge}x ${anzeigeNamen[roh] || roh}\n`;
      });
    });

    const haupt = rezepte[itemKey];
    out += `\n- ${checkbox("check_" + itemKey)} ${menge}x ${anzeigeNamen[itemKey] || itemKey}\n`;
    haupt.itemsRequired.forEach(([roh, m]) => {
      out += `    ⤷ ${m * menge}x ${anzeigeNamen[roh] || roh}\n`;
    });

    const gesamtWert = haupt.wert ? haupt.wert * menge : 0;
    const gewinn = gesamtWert - kosten;

    out += `\n💰 Materialkosten: ${kosten} Coins`;
    out += `\n💰 Gesamtwert: ${gesamtWert} Coins`;
    out += `\n📈 Gewinn: ${gewinn} Coins`;
    out += `\n⏱️ Herstellungsdauer (gesamt): ${gesamtDauer} Minuten`;

    document.getElementById("ausgabe").innerHTML = out;
  }

  function exportCSV() {
    const text = document.getElementById("ausgabe").textContent;
    const blob = new Blob([text], { type: "text/csv;charset=utf-8" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "herstellung_export.csv";
    link.click();
  }

  function importCSV(event) {
    const reader = new FileReader();
    reader.onload = function (e) {
      document.getElementById("ausgabe").textContent = e.target.result;
    };
    reader.readAsText(event.target.files[0]);
  }

  window.onload = () => {
    const select = document.getElementById("itemSelect");
    for (const key in rezepte) {
      const option = document.createElement("option");
      option.value = key;
      option.textContent = anzeigeNamen[key] || key;
      select.appendChild(option);
    }
  };
</script>

</body>
</html>
