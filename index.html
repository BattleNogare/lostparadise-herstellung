<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Crafting-System mit Kosten & Gewinn</title>
  <style>
    body { font-family: Arial; margin: 2rem; }
    select, pre { font-size: 1rem; padding: 0.5rem; width: 90%; max-width: 600px; }
    pre { background: #f0f0f0; padding: 1rem; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Crafting-System</h1>
  <select id="itemSelect" onchange="zeigeRezept()">
    <option value="">-- Item auswählen --</option>
  </select>
  <pre id="ausgabe"></pre>

  <script>
    const rezepte = {
      "craft_1": {
        wert: 10000,
        dauer: 90,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_1", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 25]
        ]
      },
      "craft_elektrik": {
        wert: 500,
        dauer: 20,
        itemsRequired: [
          ["kupfer", 10],
          ["isolierung", 5]
        ]
      }
    };

    const anzeigeNamen = {
      "craft_1": "Auto",
      "craft_blanko": "Fahrzeugrahmen",
      "schem_1": "Bauplan Auto",
      "craft_karrosserie": "Karosserie",
      "craft_motor": "Motor",
      "craft_reifen": "Reifen",
      "craft_getriebe": "Getriebe",
      "craft_batterie": "Batterie",
      "craft_elektrik": "Elektrik",
      "stoff": "Stoff",
      "schwer_stoff": "Schwerer Stoff",
      "kupfer": "Kupfer",
      "isolierung": "Isolierung"
    };

    const fundorte = {
      "stoff": "Schneiderei",
      "schwer_stoff": "Militärlager",
      "kupfer": "Mine A",
      "isolierung": "Werkstatt B"
    };

    const rohstoffPreise = {
      "stoff": 10,
      "schwer_stoff": 50,
      "kupfer": 20,
      "isolierung": 15
    };

    const select = document.getElementById("itemSelect");
    const ausgabe = document.getElementById("ausgabe");

    for (let key in rezepte) {
      const opt = document.createElement("option");
      opt.value = key;
      opt.textContent = anzeigeNamen[key] || key;
      select.appendChild(opt);
    }

    function zeigeRezept() {
      const key = select.value;
      if (!key) return ausgabe.textContent = "";

      const materialien = {};
      let gesamtDauer = 0;

      const herstellung = verarbeiteRezept(key, 0, materialien, (dauer) => gesamtDauer += dauer);
      const { liste, kosten } = generiereMaterialListe(materialien);
      const gesamtWert = rezepte[key]?.wert || 0;
      const gewinn = gesamtWert - kosten;

      ausgabe.textContent = herstellung +
        "\n📦 Gesamtliste Rohstoffe:\n" + liste +
        `\n💰 Materialkosten: ${kosten} Coins` +
        `\n💰 Gesamtwert: ${gesamtWert} Coins` +
        `\n📈 Gewinn: ${gewinn} Coins` +
        `\n⏱️ Herstellungsdauer (gesamt): ${gesamtDauer} Minuten`;
    }

    function verarbeiteRezept(item, ebene = 0, rohstoffSammlung = {}, dauerCallback) {
      const einzug = " ".repeat(ebene * 2);
      let out = `${einzug}${anzeigeNamen[item] || item}\n`;

      const daten = rezepte[item];
      if (!daten || !daten.itemsRequired) return out;
      if (daten.dauer) dauerCallback(daten.dauer);

      for (const [subItem, menge] of daten.itemsRequired) {
        out += `${einzug}  ⤷ ${menge}x ${anzeigeNamen[subItem] || subItem}\n`;
        if (rezepte[subItem]) {
          out += verarbeiteRezept(subItem, ebene + 2, rohstoffSammlung, dauerCallback);
        } else {
          rohstoffSammlung[subItem] = (rohstoffSammlung[subItem] || 0) + menge;
        }
      }

      return out;
    }

    function generiereMaterialListe(rohs) {
      let zeilen = [], kosten = 0;
      for (let key in rohs) {
        const menge = rohs[key];
        const name = anzeigeNamen[key] || key;
        const ort = fundorte[key] ? ` (Fundort: ${fundorte[key]})` : "";
        const preis = rohstoffPreise[key] || 0;
        const gesamt = preis * menge;
        kosten += gesamt;
        zeilen.push(`- ${menge}x ${name}${ort} = ${gesamt} Coins`);
      }
      return { liste: zeilen.join("\n"), kosten };
    }
  </script>
</body>
</html>
