<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Crafting-System - Lostparadise.eu</title>
  <style>
    body {
      font-family: Arial;
      margin: 2rem;
      background-color: #0d1117;
      color: #f0f0f0;
    }

    select, pre {
      font-size: 1rem;
      padding: 0.5rem;
      width: 47%;
      background-color: #151b23;
      color: #ffffff;
      border: 1px solid #666;
      margin-bottom: 1rem;
    }

    pre {
      background: #2e2e2e;
      padding: 1rem;
      white-space: pre-wrap;
      border: 1px solid #666;
    }

    .kopfzeile {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .kopfzeile img {
      max-height: 80px;
    }
.hinweis-box {
  background-color: #2e2e2e;
  color: #ffd700;
  padding: 1rem;
  border-left: 5px solid #ffd700;
  margin: 1rem 0;
}
  </style>
</head>
<body>
  <div class="kopfzeile">
    <img src="https://raw.githubusercontent.com/BattleNogare/lostparadise-herstellung/8c16ed8a0e0b9f02aaaca93c4970dc576722484c/Lostparadise-Crafting2.png" width="100" />
    <h1>Lostparadise.eu - Crafting-System</h1>
	  <br />
  </div>

  <select id="startSelect">
    <option value="">-- Optional: Startprodukt --</option>
  </select>

  <select id="endSelect">
    <option value="">-- Zielprodukt auswÃ¤hlen --</option>
  </select>

<div class="hinweis-box">
  ðŸ’¡ Hinweis: Die Werte sind berechnet und nicht garantiert! Bei Fehlern -> Marius Braun
</div>	

  <pre id="ausgabe"></pre>

  <script>
    const rezepte = {
      "craft_1": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_1", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 25]
        ]
      },
      
      "craft_2": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_1", 1],
          ["schem_2", 1],
          ["craft_karrosserie", 3],
          ["craft_motor", 4],
          ["craft_reifen", 2],
          ["craft_getriebe", 8],
          ["craft_batterie", 2],
          ["craft_elektrik", 2],
          ["stoff", 25],
          ["schwer_stoff", 10]
        ]
      },
      
      "craft_3": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_3", 1],
          ["craft_karrosserie", 4],
          ["craft_reifen", 4],
          ["craft_getriebe", 2],
          ["craft_batterie", 5],
          ["craft_elektrik", 2],
          ["craft_elektronik", 3],
          ["stoff", 50],
          ["schwer_stoff", 25]
        ]
      },
      
      "craft_4": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_4", 1],
          ["craft_karrosserie", 6],
          ["craft_reifen", 4],
          ["craft_getriebe", 2],
          ["craft_batterie", 10],
          ["craft_elektrik", 4],
          ["craft_elektronik", 5],
          ["stoff", 150],
          ["schwer_stoff", 55]
        ]
      },
      
      "craft_5": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_4", 1],
          ["schem_5", 1],
          ["craft_karrosserie", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 4],
          ["craft_batterie", 8],
          ["craft_elektrik", 6],
          ["craft_elektronik", 6],
          ["stoff", 75],
          ["schwer_stoff", 25]
        ]
      },
      
      "craft_6": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_6", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 3],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 4],
          ["stoff", 75],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_7": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_7", 1],
          ["craft_karrosserie", 8],
          ["craft_motor", 6],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 2],
          ["craft_elektrik", 10],
           ["craft_elektronik", 8],
          ["stoff", 75],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_8": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_7", 1],
          ["schem_8", 1],
          ["craft_karrosserie", 15],
          ["craft_motor", 4],
          ["craft_reifen", 2],
          ["craft_getriebe", 8],
          ["craft_batterie", 4],
          ["craft_elektrik", 15],
          ["craft_elektronik", 10],
          ["stoff", 150],
          ["schwer_stoff", 25]
        ]
      },
      
      "craft_9": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_9", 1],
          ["craft_karrosserie", 3],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 4],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 20]
        ]
      },
      
      "craft_10": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_9", 1],
          ["schem_10", 1],
          ["craft_karrosserie", 3],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 2],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 20]
        ]
      },
      
      "craft_11": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_11", 1],
          ["craft_karrosserie", 2],
          ["craft_motor", 1],
          ["craft_reifen", 4],
          ["craft_getriebe", 2],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 40],
          ["schwer_stoff", 10]
        ]
      },
      
      "craft_12": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_11", 1],
          ["schem_12", 1],
          ["craft_karrosserie", 2],
          ["craft_motor", 3],
          ["craft_reifen", 4],
          ["craft_getriebe", 4],
          ["craft_batterie", 2],
          ["craft_elektrik", 3],
          ["stoff", 40],
          ["schwer_stoff", 10]
        ]
      },
      "craft_13": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_13", 1],
          ["craft_karrosserie", 1],
          ["craft_motor", 1],
          ["craft_reifen", 1],
          ["craft_getriebe", 1],
          ["craft_batterie", 1],
          ["craft_elektrik", 1],
          ["stoff", 10],
          ["schwer_stoff", 5]
        ]
      },
      
      "craft_14": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_14", 1],
          ["craft_karrosserie", 10],
          ["craft_motor", 5],
          ["craft_reifen", 4],
          ["craft_getriebe", 5],
          ["craft_batterie", 1],
          ["craft_elektrik", 8],
          ["craft_elektronik", 6],
          ["stoff", 80],
          ["schwer_stoff", 40]
        ]
      },
      
      "craft_15": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_15", 1],
          ["craft_karrosserie", 3],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 5],
          ["craft_batterie", 1],
          ["craft_elektrik", 3],
          ["stoff", 75],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_16": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_15", 1],
          ["schem_16", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 4],
          ["stoff", 80],
          ["schwer_stoff", 20]
        ]
      },
      
      "craft_17": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_17", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 4],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 40],
          ["schwer_stoff", 20]
        ]
      },
      
      "craft_18": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_18", 1],
          ["craft_karrosserie", 6],
          ["craft_motor", 4],
          ["craft_reifen", 4],
          ["craft_getriebe", 8],
          ["craft_batterie", 1],
          ["craft_elektrik", 4],
          ["stoff", 150],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_19": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_18", 1],
          ["schem_19", 1],
          ["craft_karrosserie", 8],
          ["craft_motor", 6],
          ["craft_reifen", 4],
          ["craft_getriebe", 10],
          ["craft_batterie", 2],
          ["craft_elektrik", 8],
          ["craft_elektronik", 2],
          ["stoff", 150],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_20": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_24", 1],
          ["schem_20", 1],
          ["craft_karrosserie", 20],
          ["craft_motor", 10],
          ["craft_reifen", 6],
          ["craft_getriebe", 20],
          ["craft_batterie", 4],
          ["craft_elektrik", 20],
          ["craft_elektronik", 12],
          ["stoff", 250],
          ["schwer_stoff", 50]
        ]
      },
      
      "craft_21": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_20", 1],
          ["schem_21", 1],
          ["craft_karrosserie", 25],
          ["craft_motor", 12],
          ["craft_reifen", 6],
          ["craft_getriebe", 25],
          ["craft_batterie", 6],
          ["craft_elektrik", 25],
          ["craft_elektronik", 14],
          ["stoff", 300],
          ["schwer_stoff", 150]
        ]
      },
      
      "craft_22": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_21", 1],
          ["schem_22", 1],
          ["craft_karrosserie", 30],
          ["craft_motor", 15],
          ["craft_reifen", 6],
          ["craft_getriebe", 30],
          ["craft_batterie", 8],
          ["craft_elektrik", 35],
          ["craft_elektronik", 18],
          ["stoff", 400],
          ["schwer_stoff", 200]
        ]
      },
      
      "craft_23": {
        wert: 0,
        dauer: 3720,
        itemsRequired: [
          ["craft_22", 1],
          ["craft_25", 1],
          ["schem_23", 1],
          ["craft_karrosserie", 50],
          ["craft_motor", 40],
          ["craft_reifen", 6],
          ["craft_getriebe", 55],
          ["craft_batterie", 16],
          ["craft_elektrik", 40],
          ["craft_elektronik", 25],
          ["stoff", 800],
          ["schwer_stoff", 600]
        ]
      },
      
      "craft_24": {
        wert: 6600000,
        dauer: 120,
        itemsRequired: [
          ["craft_scaniat1", 1],
        ]
      },
      
      "craft_25": {
        wert: 0,
        dauer: 18800000,
        itemsRequired: [
          ["craft_mant1", 1],
        ]
      },
      
      "craft_karrosserie": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["aluPlatte", 50],
          ["stahlPlatte", 10],
          ["eisenStange", 25],
          ["kupferFolie", 15],
          ["kupferDraht", 5],
        ]
      },
      
      "craft_motor": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["motoroil", 10],
          ["aluBox", 3],
          ["plastic", 35],
          ["stahlBarren", 40],
          ["kupferFolie", 20],
        ]
      },
      
      "craft_reifen": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["gummi", 40],
          ["stahlBarren", 2],
          ["aluBarren", 40],
          ["plastic", 5],
        ]
      },
      
      "craft_carbon": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["aluPlatte", 20],
          ["plastic", 10],
          ["kohleStein", 5],
          ["kohleBraun", 40],
        ]
      },
      
      "craft_elektrik": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["eisenStange", 10],
          ["kupferFolie", 25],
          ["kupferDraht", 40],
          ["plastic", 35],
          ["gummi", 15],
          ["aluPlatte", 2],
        ]
      },
      
      "craft_batterie": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["aluBox", 10],
          ["schwefelacid", 25],
          ["plastic", 40],
          ["gummi", 5],
          ["craft_elektrik", 5],
        ]
      },
      
      "craft_getriebe": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["stahlBarren", 10],
          ["stahlPlatte", 25],
          ["eisenStange", 40],
          ["getriebeoil", 20],
        ]
      },
      
      "craft_elektronik": {
        wert: 0,
        dauer: 120,
        itemsRequired: [
          ["eisenStange", 15],
          ["kupferFolie", 40],
          ["kupferDraht", 60],
          ["plastic", 50],
          ["gummi", 20],
          ["aluPlatte", 4],
          ["craft_elektrik", 3],
          ["rubin", 5]
        ]
      },
      
      "schwer_stoff": {
        wert: 0,
        dauer: 4.8,
        itemsRequired: [
          ["stoff", 1],
          ["aluBarren", 0.4],
        ]
      },
      
      "stoff": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["cotton", 2],
        ]
      },
      
      "kupferFolie": {
        wert: 0,
        dauer: 4.8,
        itemsRequired: [
          ["kupferBarren", 2],
        ]
      },
      "kupferDraht": {
        wert: 0,
        dauer: 4.8,
        itemsRequired: [
          ["kupferBarren", 1],
        ]
      },
      
      "kupferPulver": {
        wert: 0,
        dauer: 4.8,
        itemsRequired: [
          ["kupferBarren", 2],
        ]
      },
      "eisenPlatte": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["eisenBarren", 1],
        ]
      },
      "eisenStange": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["eisenBarren", 1],
        ]
      },
      
      "aluPlatte": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["aluBarren", 1],
        ]
      },
      
      "stahlPlatte": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["stahlBarren", 1],
        ]
      },
      
      "aluBox": {
        wert: 0,
        dauer: 1.2,
        itemsRequired: [
          ["aluBarren", 3],
        ]
      },
            
      "Rucksack": {
        wert: 0,
        dauer: 1320,
        itemsRequired: [
          ["stoff", 200],
          ["schwer_stoff", 100],
          ["craft_carbon", 25],
          ["plastic", 15],
          ["gummi", 15],
        ]
      },
           
      "Test": {
        wert: 1000000000,
        dauer: 0,
        itemsRequired: [
          ["craft_blanko", 1],
          ["schem_1", 1],
          ["craft_karrosserie", 4],
          ["craft_motor", 2],
          ["craft_reifen", 4],
          ["craft_getriebe", 6],
          ["craft_batterie", 1],
          ["craft_elektrik", 2],
          ["stoff", 50],
          ["schwer_stoff", 25]
        ]
      },

      
    };
	
    const anzeigeNamen = {
      "craft_1": "Corvette C2",
      "craft_2": "Corvette C2 Stingray",
      "craft_3": "Tesla Model X",
      "craft_4": "Cybertruck",
      "craft_5": "Cyberbeast",
      "craft_6": "AMC Javelin",
      "craft_7": "Quartz Regalia",
      "craft_8": "Quarz Regalia D-Type",
      "craft_9": "Truffade Z-Type",
      "craft_10": "Truffade Z-Type-R",
      "craft_11": "Vapid Hotknife",
      "craft_12": "Vapid Hotknife RAW",
      "craft_13": "Monobike",
      "craft_14": "Velociraptor",
      "craft_15": "Dodge Coronet",
      "craft_16": "Hudson Hornet",
      "craft_17": "Cadillac Eldorado",
      "craft_18": "Dodge Viper SRT10",
      "craft_19": "Dodge Viper SRT10-S",
      "craft_20": "Scania S-520 ProfiLiner 8x4 Â´16",
      "craft_21": "Scania S-520 HardLiner 8x4 40ft Â´16",
      "craft_22": "Scania S-520 Hardliner 8x4 40ft ExtÂ´16",
      "craft_23": "MAN TGM HeavyDuty Â´16",
      "craft_24": "Kaufbarer Scania_v1 (6,6 Mio)",
      "craft_25": "Kaufbarer Man-LKW (18,8 Mio)",
      "craft_scaniat1": "Kaufbarer Scania-Bauplan",
      "craft_mant1": "Kaufbarer MAN-Bauplan",
      
      
      
      "schem_1": "Corvette C2 Schablone",
      "schem_2": "Corvette C2 Stingray Schablone",
      "schem_3": "Tesla Model X Schablone",
      "schem_4": "Cybertruck Schablone",
      "schem_5": "Cyberbeast Schablone",
      "schem_6": "AMC Javelin Schablone",
      "schem_7": "Quartz Regalia Schablone",
      "schem_8": "Quarz Regalia D-Type Schablone",
      "schem_9": "Truffade Z-Type Schablone",
      "schem_10": "Truffade Z-Type-R Schablone",
      "schem_11": "Vapid Hotknife Schablone",
      "schem_12": "Vapid Hotknife RAW Schablone",
      "schem_13": "Monobike Schablone",
      "schem_14": "Velociraptor Schablone",
      "schem_15": "Dodge Coronet Schablone",
      "schem_16": "Hudson Hornet Schablone",
      "schem_17": "Cadillac Eldorado Schablone",
      "schem_18": "Dodge Viper SRT10 Schablone",
      "schem_19": "Dodge Viper SRT10-S Schablone",
      "schem_20": "Scania S-520 Hardliner 8x4 Â´16 Schablone",
      "schem_21": "Scania S-520 HardLiner 8x4 40ft Â´16 Schablone",
      "schem_22": "Scania S-520 Hardliner 8x4 40ft ExtÂ´16 Schablone",
      "schem_23": "MAN TGM HeavyDuty Â´16 Schablone",
      "schem_24": "Schablone",
      "schem_25": "Schablone",
      
      "craft_blanko": "Leerer Bauplan",
      "craft_karrosserie": "Karosserieteil",
      "craft_motor": "Motorteil",
      "craft_reifen": "Reifen",
      "craft_getriebe": "Getriebeteil",
      "craft_batterie": "Autobatterie",
      "craft_elektrik": "Elektrische Teile",
      "craft_elektronik": "Elektronische Teile",
      "stoff": "Einfacher Stoff",
      "schwer_stoff": "Schwerer Stoff",
      "craft_carbon": "Carbonteil",

      "aluPlatte": "Aluminiumplatte",
      "stahlPlatte": "Stahlplatte",
      "stahlBarren": "Stahlbarren",
      "eisenStange": "Eisenstange",
      "eisenBarren": "Eisenbarren",
      "kupferFolie": "Kupferfolie",
      "kupferBarren": "Kupferbarren",
      "kupferDraht": "Kupferdraht",
      "motoroil": "MotorÃ¶l",
      "aluBox": "AluminiumgehÃ¤use",
      "aluBarren": "Aluminiumbarren",
      "plastic": "Kunststoff",
      "gummi": "Gummi",
      "getriebeoil": "GetriebeÃ¶l",
      "schwefelacid": "SchwefelsÃ¤ure",
      "cotton": "Baumwolle",
      "schlacke": "Schlacke",
      "aluErz": "BauxitErz",
      "eisenErz": "Eisenerz",
      "kupferErz": "Kupfererz",
      "kohleBraun": "Braunkohle",
      "kohleStein": "Steinkohle",
      "rubin": "Geschliffener Rubin",
      
      
    };
	
	
    const fundorte = {
      "kohleBraun": "Kohlemine",
      "kohleStein": "Kohlemine",
      "kupferErz": "Kupfermine",
      "eisenErz": "Eisenmine",
      "aluErz": "Bauxitmine",
      "schwefelacid": "Chemiewerk",
      "aluErz": "Bauxitmine",
      "plastic": "Chemiewerk",
      "gummi": "Chemiewerk",
      "getriebeoil": "Baumarkt",
      "motoroil": "Baumarkt",
      "craft_blanko": "Baumarkt",
    
    
    };
	
	
    const rohstoffPreise = {
      "schwefelacid": 85,
      "gummi": 255,
      "plastic": 175,
      "getriebeoil": 135,
      "motoroil": 65,
      "craft_blanko": 1000,
      "aluBarren": 371,
      "cotton": 150,
      "stahlBarren": 233,
      "eisenBarren": 81,
      "kupferBarren": 96,
      "rubin": 532,
      "kohleBraun": 37,
      "kohleStein": 29,
    };


    const startSelect = document.getElementById("startSelect");
    const endSelect = document.getElementById("endSelect");
    const ausgabe = document.getElementById("ausgabe");

    const erlaubteItems = Object.keys(rezepte).filter(k => k.startsWith("craft_"));
    erlaubteItems.forEach(key => {
      const name = anzeigeNamen[key] || key;
      [startSelect, endSelect].forEach(sel => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = name;
        sel.appendChild(opt);
      });
    });

    function findeRezeptPfad(start, ziel) {
      const pfad = [];
      let current = ziel;

      while (current) {
        pfad.unshift(current);
        const rezept = rezepte[current];
        if (!rezept) return null;

        const vorgaenger = rezept.itemsRequired.find(([item]) =>
          item.startsWith("craft_") && rezepte[item]
        );

        if (!vorgaenger) break;
        current = vorgaenger[0];

        if (start && current === start) {
          pfad.unshift(current);
          return pfad;
        }
      }

      return start ? null : pfad;
    }

    function updateAnzeige() {
      const start = startSelect.value;
      const ziel = endSelect.value;

      if (!ziel) {
        ausgabe.textContent = "â— Bitte ein Zielprodukt auswÃ¤hlen.";
        return;
      }

      const pfad = findeRezeptPfad(start, ziel);
      if (!pfad) {
        ausgabe.textContent = "âš ï¸ Kein Pfad von Start zu Ziel gefunden.";
        return;
      }

      const rohstoffe = {};
      const verwendetInMap = {};

      function sammleMaterialien(item, menge = 1) {
        const rezept = rezepte[item];
        if (!rezept) return;

        rezept.itemsRequired.forEach(([roh, m]) => {
          const total = m * menge;

          if (rezepte[roh]) {
            sammleMaterialien(roh, total);
            if (!verwendetInMap[roh]) verwendetInMap[roh] = new Set();
            verwendetInMap[roh].add(item);
          } else {
            if (!rohstoffe[roh]) rohstoffe[roh] = { menge: 0, verwendetIn: {} };
            rohstoffe[roh].menge += total;
            const verwendung = anzeigeNamen[item] || item;
            rohstoffe[roh].verwendetIn[verwendung] = (rohstoffe[roh].verwendetIn[verwendung] || 0) + total;
          }
        });
      }

      let startIndex = 0;
      if (start) {
        startIndex = pfad.indexOf(start) + 1;
      }
      for (let i = startIndex; i < pfad.length; i++) {
        sammleMaterialien(pfad[i]);
      }

      let rohstoffText = "ðŸ“¦ Rohstoffliste:\n";
      let gesamt = 0;
      for (const key in rohstoffe) {
        const eintrag = rohstoffe[key];
        const name = anzeigeNamen[key] || key;
        const ort = fundorte[key] ? ` (Fundort: ${fundorte[key]})` : "";
        const preis = rohstoffPreise[key] || 0;
        const kosten = preis * eintrag.menge;
        gesamt += kosten;

        rohstoffText += `- ${eintrag.menge}x ${name}${ort} ${preis} â‚¬/St = ${kosten} â‚¬\n`;
        for (const verwendung in eintrag.verwendetIn) {
          rohstoffText += `    â†³ verwendet in: ${verwendung} (${eintrag.verwendetIn[verwendung]})\n`;
        }
      }

      function baueAggregiertenHerstellplan(pfad) {
        const gesamtBedarf = {};
        const abhaengigkeiten = {};

        function zÃ¤hle(item, menge = 1) {
          if (!rezepte[item]) return;
          if (!gesamtBedarf[item]) gesamtBedarf[item] = 0;
          gesamtBedarf[item] += menge;

          for (const [roh, m] of rezepte[item].itemsRequired) {
            const total = m * menge;
            if (!rezepte[roh]) continue;
            if (!abhaengigkeiten[item]) abhaengigkeiten[item] = {};
            if (!abhaengigkeiten[item][roh]) abhaengigkeiten[item][roh] = 0;
            abhaengigkeiten[item][roh] += total;
            zÃ¤hle(roh, total);
          }
        }

        pfad.forEach(i => zÃ¤hle(i));

        const topologischSortiert = [];
        const besucht = new Set();
        function sortiere(item) {
          if (besucht.has(item)) return;
          besucht.add(item);
          const deps = abhaengigkeiten[item];
          if (deps) {
            for (const unter of Object.keys(deps)) sortiere(unter);
          }
          topologischSortiert.push(item);
        }
        pfad.forEach(i => sortiere(i));

        let herstellungText = "\nðŸ”§ Herstellprozesse:\n";
        for (const item of topologischSortiert) {
          const menge = gesamtBedarf[item];
          if (!menge || !rezepte[item]) continue;
          const name = anzeigeNamen[item] || item;
          herstellungText += `- ${menge}x ${name}\n`;
          const unter = rezepte[item].itemsRequired;
          for (const [roh, m] of unter) {
            const total = m * menge;
            const rName = anzeigeNamen[roh] || roh;
            herstellungText += `    â¤· ${total}x ${rName}\n`;
          }
        }

        return herstellungText;
      }

      const herstellungAggregiert = baueAggregiertenHerstellplan(pfad);

      ausgabe.textContent =
        `ðŸ”„ Pfad: ${pfad.map(k => anzeigeNamen[k] || k).join(" â†’ ")}\n\n` +
        rohstoffText +
        `\nðŸ’° Gesamtkosten: ${gesamt} â‚¬\n` +
        herstellungAggregiert;
    }

    startSelect.addEventListener("change", updateAnzeige);
    endSelect.addEventListener("change", updateAnzeige);
  </script>
</body>
</html>
