<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Crafting-System erweitert</title>
  <style>
    body { font-family: Arial; margin: 2rem; }
    select, input[type=number], pre, button { font-size: 1rem; padding: 0.5rem; width: 90%; max-width: 600px; margin-top: 0.5rem; }
    pre { background: #f0f0f0; padding: 1rem; white-space: pre-wrap; }
    label { display: block; margin-top: 0.25rem; }
  </style>
</head>
<body>
  <h1>Crafting-System</h1>

  <label for="itemSelect">Item ausw√§hlen:</label>
  <select id="itemSelect"></select>

  <label for="mengeInput">Menge herstellen:</label>
  <input type="number" id="mengeInput" min="1" value="1" />

  <div id="checkboxContainer"></div>

  <button onclick="zeigeErgebnis(document.getElementById('itemSelect').value)">Herstellung anzeigen</button>
  <button onclick="exportiereCSV()">Exportieren (CSV)</button>
  <input type="file" accept=".csv" onchange="importiereCSV(event)" />

  <pre id="ausgabe"></pre>

  <script>
    // Die nachfolgenden Daten wurden aus deiner Originaldatei integriert
    // (rezepte, anzeigeNamen, fundorte, rohstoffPreise)
    // 
    // Diese Bl√∂cke sind sehr umfangreich und werden aus Platzgr√ºnden hier abgek√ºrzt dargestellt.
    // Bitte ersetze sie mit deinem vollst√§ndigen Datenbestand:

    const rezepte = {/* ... deine vollst√§ndigen Rezeptdaten ... */};
    const anzeigeNamen = {/* ... deine vollst√§ndigen Namen ... */};
    const fundorte = {/* ... deine Fundorte ... */};
    const rohstoffPreise = {/* ... deine Preise ... */};

    const erlaubteItems = Object.keys(rezepte).filter(k => k.startsWith("craft_"));
    const select = document.getElementById("itemSelect");
    const ausgabe = document.getElementById("ausgabe");

    function initDropdown() {
      select.innerHTML = '<option value="">-- W√§hle ein Item --</option>';
      for (let key of erlaubteItems) {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = anzeigeNamen[key] || key;
        select.appendChild(opt);
      }
    }

    function generiereCheckboxen(itemKey) {
      const container = document.getElementById("checkboxContainer");
      container.innerHTML = "<strong>Komponenten ausw√§hlen:</strong>";
      const daten = rezepte[itemKey];
      if (!daten?.itemsRequired) return;

      daten.itemsRequired.forEach(([item]) => {
        const label = document.createElement("label");
        label.innerHTML = `<input type="checkbox" checked value="${item}"> ${anzeigeNamen[item] || item}`;
        container.appendChild(label);
      });
    }

    function zeigeErgebnis(itemKey) {
      const menge = parseInt(document.getElementById("mengeInput").value) || 1;
      const aktiv = new Set([...document.querySelectorAll('#checkboxContainer input:checked')].map(cb => cb.value));
      const daten = rezepte[itemKey];
      if (!daten) return ausgabe.textContent = "Kein Item ausgew√§hlt.";

      const rohstoffe = {};
      let kosten = 0;
      let gesamtDauer = 0;

      function verarbeite(item, faktor = 1) {
        const rezept = rezepte[item];
        if (!rezept) return;
        gesamtDauer += rezept.dauer * faktor;
        for (const [sub, m] of rezept.itemsRequired) {
          if (!aktiv.has(sub)) continue;
          if (rezepte[sub]) {
            verarbeite(sub, m * faktor);
          } else {
            rohstoffe[sub] = (rohstoffe[sub] || 0) + m * faktor;
          }
        }
      }

      verarbeite(itemKey, menge);

      let ausgabeText = `üì¶ Rohstoffe f√ºr ${menge}x ${anzeigeNamen[itemKey] || itemKey}:
`;
      for (let key in rohstoffe) {
        const name = anzeigeNamen[key] || key;
        const ort = fundorte[key] ? ` (${fundorte[key]})` : "";
        const preis = rohstoffPreise[key] || 0;
        const gesamt = preis * rohstoffe[key];
        kosten += gesamt;
        ausgabeText += `- ${rohstoffe[key]}x ${name}${ort} = ${gesamt} ‚Ç¨\n`;
      }

      ausgabeText += `\nüí∞ Materialkosten: ${kosten} ‚Ç¨`;
      ausgabeText += `\nüí∞ Produktwert: ${daten.wert * menge} ‚Ç¨`;
      ausgabeText += `\nüìà Gewinn: ${(daten.wert * menge) - kosten} ‚Ç¨`;
      ausgabeText += `\n‚è±Ô∏è Gesamtdauer: ${gesamtDauer} Sekunden`;

      ausgabe.textContent = ausgabeText;
    }

    function exportiereCSV() {
      const item = select.value;
      const menge = document.getElementById("mengeInput").value;
      const checked = [...document.querySelectorAll('#checkboxContainer input:checked')].map(cb => cb.value);
      const csv = `item,menge,enabled_items\n${item},${menge},"${checked.join('|')}"`;
      const blob = new Blob([csv], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "craft_config.csv";
      a.click();
    }

    function importiereCSV(event) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const line = e.target.result.trim().split("\n")[1].split(",");
        const item = line[0];
        const menge = line[1];
        const enabled = line[2].replace(/"/g, '').split('|');

        select.value = item;
        document.getElementById("mengeInput").value = menge;
        generiereCheckboxen(item);

        setTimeout(() => {
          document.querySelectorAll("#checkboxContainer input").forEach(input => {
            input.checked = enabled.includes(input.value);
          });
          zeigeErgebnis(item);
        }, 100);
      };
      reader.readAsText(event.target.files[0]);
    }

    select.addEventListener("change", () => {
      generiereCheckboxen(select.value);
      ausgabe.textContent = "";
    });

    initDropdown();
  </script>
</body>
</html>
